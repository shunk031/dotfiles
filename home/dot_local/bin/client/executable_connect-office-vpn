#!/usr/bin/env bash

# set -Eeuox pipefail

function connect-office-vpn() {
    local keychain_db="${HOME}/Library/Keychains/vpn.keychain-db"
    local hostname password protocol

    hostname=$(security find-generic-password -a "${USER}" -w -s vpn-office-hostname "${keychain_db}")
    password=$(security find-generic-password -a "${USER}" -w -s vpn-office-password "${keychain_db}")
    protocol=$(security find-generic-password -a "${USER}" -w -s vpn-office-protocol "${keychain_db}")

    # shellcheck disable=SC2028
    echo -e "${password}\npush\n" | sudo openconnect -vvvv \
        --background \
        --protocol="${protocol}" \
        --user="$USER" \
        --useragent="Mozilla/5.0 (Linux; Android 13) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.105 Mobile Safari/537.36" \
        "${hostname}"
}

connect-office-vpn
